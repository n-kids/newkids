<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뉴키즈 - 제안/견적 요청</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header></header>

    <section class="sub-hero bg-proposal">
        <div class="container">
            <h1>제안서 및 견적 요청</h1>
            <p>원하시는 프로그램을 선택해주시면 맞춤형 제안서를 보내드립니다.</p>
        </div>
    </section>

    <section style="background-color: #f8f9fa;">
        <div class="container">

            <form id="proposalForm" class="proposal-box">
                <h3 class="form-section-title">👤 신청자 정보</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">원명 (필수)</label>
                        <input type="text" name="wonName" class="form-input" placeholder="예: 해바라기 어린이집" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">담당자 성함 (필수)</label>
                        <input type="text" name="manager" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">연락처 (필수)</label>
                        <input type="tel" name="phone" class="form-input" placeholder="010-0000-0000" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">방문 희망 날짜 (선택)</label>
                        <input type="date" name="visitDate" class="form-input">
                    </div>
                </div>

                <h3 class="form-section-title" style="margin-top: 30px;">📚 관심 프로그램 (중복 선택 가능)</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">아래 카테고리를 클릭하여 세부 프로그램을 선택해 주세요.</p>

                <div class="proposal-list-box">

                    <div class="category-wrapper">
                        <div class="proposal-category-header" onclick="toggleProposalCategory(this)">
                            <span>🎓 교육 프로그램</span> <span class="toggle-icon">▼</span>
                        </div>
                        <div class="proposal-category-content">
                            <div class="proposal-check-grid">
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="한글/독서"> 📚 한글 & 독서
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="미술/자연"> 🎨 미술 & 자연 환경
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="수학/과학"> 🔬 수학 & 과학
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="코딩/직업"> 💻 코딩 & 직업교육
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="영어/지도"> 🔤 영어 & 지도
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="통합/누리"> 👶 통합보육 & 누리과정
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="category-wrapper">
                        <div class="proposal-category-header" onclick="toggleProposalCategory(this)">
                            <span>🎉 행사 프로그램</span> <span class="toggle-icon">▼</span>
                        </div>
                        <div class="proposal-category-content">
                            <div class="proposal-check-grid">
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="시즌행사"> 🎅 시즌 테마 행사 
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="원어민행사"> 🌍 원어민 행사 
                                </label>
                                <label class="proposal-item">
                                    <input type="checkbox" name="interest" value="부모참여"> 👨‍👩‍👧‍👦 부모 참여 행사
                                </label>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="form-group full-width" style="margin-top: 30px;">
                    <label class="form-label">문의사항 및 요청 내용</label>
                    <textarea name="inquiry" class="form-input" placeholder="궁금하신 점이나 특별히 요청하실 내용을 자유롭게 적어주세요."></textarea>
                </div>

                <button type="submit" class="btn-submit">견적 및 상담 요청하기</button>
            </form>

        </div>
    </section>

    <footer></footer>
    <script src="config.js"></script>
    <script src="manager.js"></script>

    <script>
        // [신규] 제안서 카테고리 토글 함수
        function toggleProposalCategory(header) {
            header.classList.toggle('active');
            header.nextElementSibling.classList.toggle('show');
        }

        const form = document.getElementById('proposalForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const btn = form.querySelector('.btn-submit');
            const originalText = btn.innerText;

            // 관심 프로그램 수집 (숨겨져 있어도 체크된 값은 가져옴)
            const interests = [];
            form.querySelectorAll('input[name="interest"]:checked').forEach(cb => {
                interests.push(cb.value);
            });

            btn.disabled = true;
            btn.innerText = "전송 중...";

            const formData = new FormData(form);
            const data = {
                type: "PROPOSAL",
                wonName: formData.get("wonName"),
                manager: formData.get("manager"),
                phone: formData.get("phone"),
                // orderDetails 필드에 관심분야 저장 (DB 호환성)
                orderDetails: "관심분야: " + (interests.join(", ") || "선택 없음"),
                deliveryDate: formData.get("visitDate") || "미지정",
                remarks: formData.get("inquiry"),
                email: "",
                timestamp: new Date().toLocaleString()
            };

            // [중요] PROPOSAL_SHEET_URL 사용
            if (typeof CONFIG === 'undefined' || !CONFIG.PROPOSAL_SHEET_URL) {
                alert("설정 오류: config.js에 PROPOSAL_SHEET_URL이 없습니다.");
                btn.disabled = false; btn.innerText = originalText;
                return;
            }

            fetch(CONFIG.PROPOSAL_SHEET_URL, {
                method: "POST",
                body: JSON.stringify(data)
            })
                .then(res => res.json())
                .then(res => {
                    if (res.result === 'success') {
                        alert("상담 요청이 성공적으로 접수되었습니다.\n담당자가 확인 후 연락드리겠습니다.");
                        window.location.reload();
                    } else {
                        throw new Error(res.error);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("전송 중 오류가 발생했습니다.");
                    btn.disabled = false;
                    btn.innerText = originalText;
                });
        });
    </script>
</body>
</html>