<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´í‚¤ì¦ˆ - êµìœ¡ í”„ë¡œê·¸ë¨</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header></header>

    <div id="loading" class="loading-overlay" style="display: flex;">
        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
    </div>

    <section class="sub-hero bg-child">
        <div class="container-wide">
            <h1 id="page-title">êµìœ¡ í”„ë¡œê·¸ë¨</h1>
            <p id="page-desc">ì•„ì´ë“¤ì˜ ê¿ˆì„ í‚¤ì›Œì£¼ëŠ” ë‹¤ì–‘í•œ êµì¬ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤.</p>
        </div>
    </section>

    <section>
        <div class="container">
            <div id="post-list" class="main-grid">
            </div>
        </div>
    </section>

    <footer></footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="manager.js"></script>

    <script>
        const NO_IMAGE_URL = "https://placehold.co/400x300/e0e0e0/666666?text=No+Image";
        const loadingEl = document.getElementById('loading');
        const postListEl = document.getElementById('post-list');
        const pageTitleEl = document.getElementById('page-title');

        // ì¹´í…Œê³ ë¦¬ë³„ í•œê¸€ ì œëª© ë§¤í•‘
// [child.html] categoryTitles ê°ì²´ ìˆ˜ì •
const categoryTitles = {
    'korean': 'ğŸ‡°ğŸ‡· í•œê¸€ í”„ë¡œê·¸ë¨', // ì•„ì´ì½˜ ë³€ê²½
    'reading': 'ğŸ“– ë…ì„œ í”„ë¡œê·¸ë¨',
    'english': 'ğŸ”¤ ì˜ì–´ í”„ë¡œê·¸ë¨',
    'math': 'ğŸ”¢ ìˆ˜í•™ í”„ë¡œê·¸ë¨',
    'science': 'ğŸ”¬ ê³¼í•™ í”„ë¡œê·¸ë¨',
    'art': 'ğŸ¨ ë¯¸ìˆ  í”„ë¡œê·¸ë¨',
    'coding': 'ğŸ’» ì½”ë”© í”„ë¡œê·¸ë¨',
    'environment': 'ğŸŒ± í™˜ê²½ í”„ë¡œê·¸ë¨',
    'nuri': 'ğŸ‘¶ ëˆ„ë¦¬ê³¼ì •',
    'infant': 'ğŸ§¸ ì˜ì•„ í”„ë¡œê·¸ë¨', // ì¶”ê°€ë¨
    'special': 'â­ ê¸°íƒ€(íŠ¹ìƒ‰) í”„ë¡œê·¸ë¨'
};

        document.addEventListener("DOMContentLoaded", function () {
            // ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
            loadCategoryPosts();

            // URLì˜ í•´ì‹œ(#)ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰ (ë©”ë‰´ í´ë¦­ ì‹œ)
            window.addEventListener('hashchange', loadCategoryPosts);
        });

        async function loadCategoryPosts() {
            // 1. í˜„ì¬ URLì˜ í•´ì‹œê°’ ê°€ì ¸ì˜¤ê¸° (ì˜ˆ: #korean -> korean)
            // í•´ì‹œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ 'korean' ì„¤ì •
            const category = window.location.hash.substring(1) || 'korean';

            // 2. í˜ì´ì§€ ì œëª© ë³€ê²½
            if (categoryTitles[category]) {
                pageTitleEl.innerText = categoryTitles[category];
            }

            loadingEl.style.display = 'flex';
            postListEl.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

            try {
                // 3. Supabaseì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì¡°íšŒ
                let query = window.sb
                    .from('total_posts')
                    .select('id, title, thumbnail_url, content, created_at')
                    .eq('category', category)
                    .order('order_num', { ascending: true })
                    .order('created_at', { ascending: false });

                const { data, error } = await query;

                if (error) throw error;

                if (!data || data.length === 0) {
                    postListEl.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #666;">
                                ì•„ì§ ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>`;
                    return;
                }

                // 4. ë°ì´í„° ë°”ì¸ë”© (ì¹´ë“œ ìƒì„±)
                data.forEach(item => {
                    let thumb = item.thumbnail_url;

                    // ì¸ë„¤ì¼ì´ ì—†ìœ¼ë©´ ë³¸ë¬¸ ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ì¶”ì¶œ ì‹œë„
                    if (!thumb && item.content) {
                        try {
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(item.content, 'text/html');
                            const firstImg = doc.querySelector('img');
                            if (firstImg) thumb = firstImg.src;
                        } catch (e) { }
                    }

                    // ê·¸ë˜ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€
                    if (!thumb) thumb = NO_IMAGE_URL;

                    // ì¹´ë“œ HTML ìƒì„± (í´ë¦­ ì‹œ view.htmlë¡œ ì´ë™)
                    const cardHtml = `
                            <a href="view.html?id=${item.id}" class="card post-card">
                                <div class="card-img-wrap post-thumb">
                                    <img src="${thumb}" alt="${item.title}"
                                         onerror="this.onerror=null; this.src='${NO_IMAGE_URL}';">
                                </div>
                                <div class="card-body post-info">
                                    <h3 class="card-title post-title">${item.title}</h3>
                                    <p class="card-text post-desc">
                                        ${stripHtml(item.content).substring(0, 50)}...
                                    </p>
                                    <span class="view-date" style="font-size:0.85rem; color:#999;">
                                        ${window.formatDate(item.created_at)}
                                    </span>
                                </div>
                            </a>
                        `;
                    postListEl.insertAdjacentHTML('beforeend', cardHtml);
                });

            } catch (err) {
                console.error(err);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        // HTML íƒœê·¸ ì œê±°ìš© ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°ìš©)
        function stripHtml(html) {
            let tmp = document.createElement("DIV");
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || "";
        }
    </script>
</body>
</html>