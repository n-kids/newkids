<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´í‚¤ì¦ˆ - ì†Œì‹ ë° ì»¤ë®¤ë‹ˆí‹°</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="header-inner">
            <a href="index.html" class="logo">
                <img src="logo.jpg" alt="ë‰´í‚¤ì¦ˆ ë¡œê³ " class="logo-img">
            </a>
            <button class="mobile-btn">â˜°</button>
            <ul class="nav-menu">
                <li><a href="index.html">í™ˆìœ¼ë¡œ</a></li>
                <li><a href="#">íšŒì‚¬ì†Œê°œ</a></li>
                <li><a href="#">êµìœ¡ í”„ë¡œê·¸ë¨</a></li>
                <li><a href="#">í–‰ì‚¬ í”„ë¡œê·¸ë¨</a></li>
                <li><a href="notice.html" style="color:#f4a261; font-weight:bold;">ê²Œì‹œíŒ</a></li>
            </ul>
        </div>
    </header>

    <div class="board-header-section">
        <div class="container">
            <h1 id="notice-title" style="font-size: 2rem; margin-bottom:10px;">ğŸ“¢ ì†Œì‹ & ì»¤ë®¤ë‹ˆí‹°</h1>
            <p id="notice-desc" style="color:#666;">ë‰´í‚¤ì¦ˆì˜ ê³µì§€ì‚¬í•­ê³¼ ììœ ë¡œìš´ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
        </div>
    </div>

    <div class="board-container">

        <div class="board-tab-menu">
            <button class="tab-btn active" onclick="switchBoard('notice')">ê³µì§€ì‚¬í•­</button>
            <button class="tab-btn" onclick="switchBoard('free')">ììœ ê²Œì‹œíŒ</button>
        </div>

        <div class="board-action-bar" id="write-btn-area" style="display:none;">
            <a href="write.html" class="btn-write">âœï¸ ê¸€ì“°ê¸°</a>
        </div>

        <div class="board-list-head">
            <div class="b-num">ë²ˆí˜¸</div>
            <div class="b-cat">ì‘ì„±ì</div> <div class="b-title">ì œëª©</div>
            <div class="b-date">ì‘ì„±ì¼</div>
        </div>

        <div id="board-list-wrapper">
            <div style="text-align:center; padding:50px; color:#999;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>

        <div id="pagination-box" class="pagination" style="margin-top:40px;"></div>

    </div>

    <footer>
        <div class="container">
            <p>(ì£¼)ë‰´í‚¤ì¦ˆ | ëŒ€í‘œ: í™ê¸¸ë™ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 123-45-67890</p>
            <p class="copyright">Â© 2026 NEW KIDS. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="manager.js"></script>

    <script>
        // ì „ì—­ ì„¤ì •
        const ITEMS_PER_PAGE = 10;
        let currentPage = 1;
        let currentCategory = 'notice'; // ê¸°ë³¸ê°’: ê³µì§€ì‚¬í•­

        document.addEventListener("DOMContentLoaded", () => {
            const checkSb = setInterval(() => {
                if (window.sb) {
                    clearInterval(checkSb);
                    loadNoticeHeader(); 
                    loadBoardList(1);   
                }
            }, 100);
        });

        // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì„¤ì •í•œ í—¤ë” ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        async function loadNoticeHeader() {
            try {
                const { data, error } = await window.sb.from('program_categories')
                    .select('hero_title, hero_desc')
                    .eq('code', 'notice')
                    .single();

                if (data) {
                    if (data.hero_title) document.getElementById('notice-title').innerHTML = data.hero_title;
                    if (data.hero_desc) document.getElementById('notice-desc').innerHTML = data.hero_desc;
                }
            } catch (e) {
                console.log("í—¤ë” ì •ë³´ ë¡œë“œ ì•ˆë¨(ê¸°ë³¸ í…ìŠ¤íŠ¸ ìœ ì§€)");
            }
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchBoard(cat) {
            currentCategory = cat;
            currentPage = 1;

            // íƒ­ ìŠ¤íƒ€ì¼ ë³€ê²½
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (cat === 'notice') document.querySelectorAll('.tab-btn')[0].classList.add('active');
            else document.querySelectorAll('.tab-btn')[1].classList.add('active');

            // ê¸€ì“°ê¸° ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ (ììœ ê²Œì‹œíŒì¼ ë•Œë§Œ ë³´ì„)
            const writeBtn = document.getElementById('write-btn-area');
            if (cat === 'free') writeBtn.style.display = 'flex';
            else writeBtn.style.display = 'none';

            loadBoardList(1);
        }

        // ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadBoardList(page) {
            currentPage = page;
            const listDiv = document.getElementById('board-list-wrapper');
            const from = (page - 1) * ITEMS_PER_PAGE;
            const to = from + ITEMS_PER_PAGE - 1;

            listDiv.innerHTML = '<div style="text-align:center; padding:50px; color:#999;">ë¡œë”© ì¤‘...</div>';

            // DB ì¡°íšŒ (ì¹´í…Œê³ ë¦¬ë¡œ í•„í„°ë§)
            const { data, count, error } = await window.sb.from('total_posts')
                .select('id, title, category, created_at, link_url', { count: 'exact' }) // link_urlì„ ì‘ì„±ìë¡œ ì‚¬ìš©
                .eq('category', currentCategory)
                .order('created_at', { ascending: false })
                .range(from, to);

            if (error) {
                listDiv.innerHTML = `<div style="text-align:center; padding:30px;">ì—ëŸ¬: ${error.message}</div>`;
                return;
            }

            if (!data || data.length === 0) {
                listDiv.innerHTML = `<div style="text-align:center; padding:50px; border-bottom:1px solid #eee;">ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                document.getElementById('pagination-box').innerHTML = '';
                return;
            }

            let html = '';
            data.forEach(item => {
                const date = new Date(item.created_at).toISOString().split('T')[0];
                // ì‘ì„±ì: ê³µì§€ì‚¬í•­ì´ë©´ 'ê´€ë¦¬ì', ììœ ê²Œì‹œíŒì´ë©´ ì…ë ¥ëœ ì´ë¦„(link_urlì— ì €ì¥ë¨) ì‚¬ìš©
                let author = (currentCategory === 'notice') ? 'ê´€ë¦¬ì' : (item.link_url || 'ìµëª…');

                // [ìˆ˜ì •ëœ ë¶€ë¶„] onclick="alert()" ì„ onclick="location.href='view.html?id=...'" ë¡œ ë³€ê²½
                html += `
                    <div class="board-list-row" onclick="location.href='view.html?id=${item.id}'">
                        <div class="b-num">${item.id}</div>
                        <div class="b-cat"><span class="badge" style="background:#f1f3f5; color:#555;">${author}</span></div>
                        <div class="b-title">${item.title}</div>
                        <div class="b-date">${date}</div>
                    </div>`;
            });
            listDiv.innerHTML = html;

            renderPagination(count, currentPage);
        }

        // í˜ì´ì§€ë„¤ì´ì…˜
        function renderPagination(totalCount, current) {
            const wrapper = document.getElementById('pagination-box');
            wrapper.innerHTML = '';
            const totalPages = Math.ceil(totalCount / ITEMS_PER_PAGE);
            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                wrapper.innerHTML += `<button class="page-btn ${i === current ? 'active' : ''}" onclick="loadBoardList(${i})">${i}</button>`;
            }
        }
    </script>
</body>
</html>
